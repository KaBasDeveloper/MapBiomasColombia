/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var remap = 
    /* color: #d16cd6 */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-71.68607225494085, 2.811758908357087],
                  [-71.69671526031195, 2.8074725326804373],
                  [-71.74495210723578, 2.8009572115427086],
                  [-71.74014558868109, 2.76923736870078],
                  [-71.73808565215765, 2.7536343229155205],
                  [-71.7052983291596, 2.757406506606222],
                  [-71.674570942685, 2.7694088296028236],
                  [-71.6529416091889, 2.7846687502981955],
                  [-71.64075365142523, 2.789298125408917],
                  [-71.66169633941351, 2.8014715803199164],
                  [-71.67628755645453, 2.8079868985923984]]]),
            {
              "from": "27,6,",
              "to": "0,0,",
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-71.0726431529154, 2.897426301299388],
                  [-71.07006823226111, 2.890054274326361],
                  [-71.06182848616736, 2.888511285872429],
                  [-71.04672228499548, 2.888168399264564],
                  [-71.0393408457865, 2.8912543750069717],
                  [-71.04552065535681, 2.9039410758790236]]]),
            {
              "from": "27,6,",
              "to": "0,0,",
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-71.28239602216937, 2.766640571525221],
                  [-71.29647225507952, 2.7724702410486053],
                  [-71.31329507002093, 2.7590962507777106],
                  [-71.32119149336077, 2.735434207588398],
                  [-71.33801430830218, 2.7203451244029173],
                  [-71.32668465742327, 2.7049129122162805],
                  [-71.28857583173968, 2.7378347260716076],
                  [-71.28308266767718, 2.7573816257446757]]]),
            {
              "from": "27,6,",
              "to": "0,0,",
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-71.14331777684444, 2.7501189221514015],
                  [-71.1573940097546, 2.754234043184318],
                  [-71.20065267674678, 2.6822173911680482],
                  [-71.18382986180538, 2.6626692776635874],
                  [-71.13679464452022, 2.6595827050141687],
                  [-71.13164480321163, 2.72988603763959]]]),
            {
              "from": "27,6,",
              "to": "0,0,",
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-71.1709011961453, 2.908858590280006],
                  [-71.16163148178983, 2.9105729909286113],
                  [-71.14618195786404, 2.908858590280006],
                  [-71.12935914292264, 2.9208593399956557],
                  [-71.11219300522733, 2.962689518672202],
                  [-71.1825741697781, 2.991832562766999],
                  [-71.19733704819608, 2.9842897312428334],
                  [-71.19459046616483, 2.958575144590416],
                  [-71.18360413803983, 2.9376601740216746],
                  [-71.1767376829617, 2.92154509325362]]]),
            {
              "from": "27,6,",
              "to": "0,0,",
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-71.23887910141873, 2.9506892182705995],
                  [-71.2206829954617, 2.961318062342894],
                  [-71.2096966673367, 2.986346872252551],
                  [-71.21450318589139, 3.0089751684698176],
                  [-71.26874818100858, 3.0514876639778143],
                  [-71.37895478501248, 3.005889519295353],
                  [-71.34977235093045, 2.954117888770983],
                  [-71.28385438218045, 2.9417746255052237]]]),
            {
              "from": "27,6,",
              "to": "0,0,",
              "system:index": "5"
            })]),
    include = 
    /* color: #3ac5ff */
    /* shown: false */
    ee.Feature(
        ee.Geometry.MultiPolygon(
            [[[[-71.31208386010893, 3.5892247389966423],
               [-71.31354298181303, 3.5853699258695584],
               [-71.31268467492826, 3.581086781114409],
               [-71.30311692181613, 3.584276543851842],
               [-71.3002845090964, 3.5856471475764087],
               [-71.29316056195285, 3.5838482297667107],
               [-71.29015648785617, 3.581449667184648],
               [-71.28655159894015, 3.578965435027934],
               [-71.28020012799288, 3.5767381866769408],
               [-71.27582276288058, 3.5762242055195674],
               [-71.26792633954074, 3.5766525231707242],
               [-71.26131737652804, 3.578537118457823],
               [-71.25874245587374, 3.580250383536616],
               [-71.2566825193503, 3.583762566925612],
               [-71.2574549955466, 3.58727473683076],
               [-71.2577983183005, 3.5900159332330253],
               [-71.25994408551242, 3.592328811297618],
               [-71.2658664030173, 3.5937850648499428],
               [-71.26784050885226, 3.591557852593843],
               [-71.27590859356906, 3.5927571214072085],
               [-71.28423417035128, 3.594813007134395],
               [-71.2918731016257, 3.5966119033440687],
               [-71.29831040326144, 3.5979824885497154],
               [-71.30191529217745, 3.59712587303773],
               [-71.30629265728976, 3.5960979333606202],
               [-71.30852425519015, 3.5943846979899887],
               [-71.30964005414035, 3.5919005009870166]]],
             [[[-69.36166001918848, 3.9968691210695613],
               [-69.36680986049707, 3.996012901259837],
               [-69.3699855959707, 3.99327299186312],
               [-69.37230302455957, 3.991132431282366],
               [-69.3722171938711, 3.98916311062004],
               [-69.36886979702051, 3.987621899852404],
               [-69.36629487636621, 3.9873650311101323],
               [-69.36217500331934, 3.989591224209123],
               [-69.35951425197656, 3.9899337149197467],
               [-69.35745431545313, 3.991218053812746],
               [-69.35771180751856, 3.9938723478254463],
               [-69.35839845302637, 3.9961841452932902],
               [-69.36071588161523, 3.9973828525262682]]],
             [[[-67.87751803691474, 4.471272372151404],
               [-67.87717471416083, 4.467507305940383],
               [-67.87700305278388, 4.463742220398613],
               [-67.8780330210456, 4.46014825709084],
               [-67.87494311626044, 4.453302564060171],
               [-67.87219653422919, 4.448852829424076],
               [-67.86756167705146, 4.452446847950323],
               [-67.86533007915106, 4.463057657315405],
               [-67.86172519023505, 4.472128066319954],
               [-67.86344180400458, 4.475721970910946],
               [-67.86515841777411, 4.478460172089731],
               [-67.86893496806708, 4.47657765987995],
               [-67.87219653422919, 4.474695142827748],
               [-67.8754581003913, 4.473497174910559]]],
             [[[-69.17183016797506, 4.044214557294195],
               [-69.17148684522115, 4.037365171289438],
               [-69.16668032666647, 4.027433458952685],
               [-69.15878390332662, 4.023666225996664],
               [-69.15088747998678, 4.024008702440158],
               [-69.14711092969381, 4.031885620869593],
               [-69.146424284186, 4.041474809833754],
               [-69.15363406201803, 4.047639228593569],
               [-69.16153048535787, 4.05037895520452],
               [-69.16702364942037, 4.048666627159375]]],
             [[[-67.85506582837552, 4.925038461803306],
               [-67.87875509839505, 4.920591729821102],
               [-67.89008474927395, 4.91135611464432],
               [-67.89866781812161, 4.892884500750478],
               [-67.90759420972317, 4.8809118859976435],
               [-67.91652060132473, 4.873728214562876],
               [-67.9144606648013, 4.8504662758929555],
               [-67.90210104566067, 4.846019049185434],
               [-67.87188864331692, 4.8443085695807575],
               [-67.85197592359036, 4.850124182570465],
               [-67.84922934155911, 4.863123606874156],
               [-67.8540358601138, 4.880569808148665],
               [-67.85884237866848, 4.895278998017914],
               [-67.8595290241763, 4.911014052364756]]]]),
        {
          "system:index": "0"
        }),
    nicfi = ee.ImageCollection("projects/planet-nicfi/assets/basemaps/americas"),
    geometry2 = 
    /* color: #98ff00 */
    /* shown: false */
    /* displayProperties: [
      {
        "type": "rectangle"
      }
    ] */
    ee.Geometry.Polygon(
        [[[-73.13500630112785, 3.7523035899671617],
          [-73.13500630112785, 2.331615411241491],
          [-69.78966938706535, 2.331615411241491],
          [-69.78966938706535, 3.7523035899671617]]], null, false),
    id_6 = 
    /* color: #d63000 */
    /* displayProperties: [
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      }
    ] */
    ee.Feature(
        ee.Geometry.MultiPolygon(
            [[[[-67.90771842063423, 4.917104251908339],
               [-67.90771842063423, 4.914709832915944],
               [-67.90514349997993, 4.914709832915944],
               [-67.90514349997993, 4.917104251908339]]],
             [[[-67.91252493918891, 4.9244584849700805],
               [-67.91252493918891, 4.922064092431505],
               [-67.91097998679633, 4.922064092431505],
               [-67.91097998679633, 4.9244584849700805]]],
             [[[-67.84773396844018, 4.878137878680203],
               [-67.84773396844018, 4.876256440577985],
               [-67.84636067742456, 4.876256440577985],
               [-67.84636067742456, 4.878137878680203]]],
             [[[-68.14468119643219, 4.896402955524346],
               [-68.14468119643219, 4.895120192351848],
               [-68.14330790541656, 4.895120192351848],
               [-68.14330790541656, 4.896402955524346]]],
             [[[-68.1479427625943, 4.890673260981589],
               [-68.1479427625943, 4.889133931702053],
               [-68.14639781020172, 4.889133931702053],
               [-68.14639781020172, 4.890673260981589]]],
             [[[-68.14013216994294, 4.8947353629204455],
               [-68.14013216994294, 4.893965703393617],
               [-68.13901637099275, 4.893965703393617],
               [-68.13901637099275, 4.8947353629204455]]],
             [[[-68.22759364150056, 4.873697684343427],
               [-68.22759364150056, 4.87181623380547],
               [-68.22484705946931, 4.87181623380547],
               [-68.22484705946931, 4.873697684343427]]],
             [[[-68.25299952528962, 4.854027714200854],
               [-68.25299952528962, 4.851975162494858],
               [-68.24973795912751, 4.851975162494858],
               [-68.24973795912751, 4.854027714200854]]],
             [[[-68.26535914443025, 4.850777837783748],
               [-68.26535914443025, 4.84838318199187],
               [-68.2622692396451, 4.84838318199187],
               [-68.2622692396451, 4.850777837783748]]],
             [[[-68.31153605483064, 4.823922998062949],
               [-68.31153605483064, 4.822041408893557],
               [-68.30999110243806, 4.822041408893557],
               [-68.30999110243806, 4.823922998062949]]],
             [[[-68.30999110243806, 4.831107199634581],
               [-68.30999110243806, 4.829738786153997],
               [-68.30861781142244, 4.829738786153997],
               [-68.30861781142244, 4.831107199634581]]],
             [[[-68.30569956801423, 4.825120370273964],
               [-68.30569956801423, 4.824094051365257],
               [-68.30449793837556, 4.824094051365257],
               [-68.30449793837556, 4.825120370273964]]],
             [[[-68.30861781142244, 4.817593995593375],
               [-68.30861781142244, 4.816054499593795],
               [-68.3069011976529, 4.816054499593795],
               [-68.3069011976529, 4.817593995593375]]],
             [[[-68.33797190688142, 4.818449269642342],
               [-68.33797190688142, 4.815028166991107],
               [-68.33522532485017, 4.815028166991107],
               [-68.33522532485017, 4.818449269642342]]],
             [[[-68.43719218276033, 4.803054172284015],
               [-68.43719218276033, 4.800659348093598],
               [-68.4354755689908, 4.800659348093598],
               [-68.4354755689908, 4.803054172284015]]],
             [[[-68.48766062758455, 4.7712365375165],
               [-68.48766062758455, 4.769183736136885],
               [-68.48663065932283, 4.769183736136885],
               [-68.48663065932283, 4.7712365375165]]],
             [[[-68.45641825697908, 4.765420251005753],
               [-68.45641825697908, 4.763367432247053],
               [-68.45367167494783, 4.763367432247053],
               [-68.45367167494783, 4.765420251005753]]],
             [[[-67.96780611732721, 4.682774883498885],
               [-67.96780611732721, 4.680892908929952],
               [-67.96574618080378, 4.680892908929952],
               [-67.96574618080378, 4.682774883498885]]],
             [[[-67.961282985003, 4.686538817444195],
               [-67.961282985003, 4.685341204295921],
               [-67.95990969398737, 4.685341204295921],
               [-67.95990969398737, 4.686538817444195]]],
             [[[-67.8380907158637, 4.8018807928355525],
               [-67.8380907158637, 4.800854438875007],
               [-67.83731823966741, 4.800854438875007],
               [-67.83731823966741, 4.8018807928355525]]],
             [[[-67.83620244071722, 4.783406185559237],
               [-67.83620244071722, 4.7815244845916425],
               [-67.83474331901311, 4.7815244845916425],
               [-67.83474331901311, 4.783406185559237]]],
             [[[-67.8628406146889, 4.50929203706449],
               [-67.8628406146889, 4.508436386482111],
               [-67.86198230780414, 4.508436386482111],
               [-67.86198230780414, 4.50929203706449]]],
             [[[-67.86352726019672, 4.518704126917352],
               [-67.86352726019672, 4.516308333810453],
               [-67.86146732367328, 4.516308333810453],
               [-67.86146732367328, 4.518704126917352]]],
             [[[-67.90266605414203, 4.467535116955472],
               [-67.90266605414203, 4.466508277399428],
               [-67.90146442450336, 4.466508277399428],
               [-67.90146442450336, 4.467535116955472]]],
             [[[-67.89717289007953, 4.474894091677405],
               [-67.89717289007953, 4.473867262433088],
               [-67.89631458319477, 4.473867262433088],
               [-67.89631458319477, 4.474894091677405]]],
             [[[-69.22430531014831, 3.9871508431701064],
               [-69.22430531014831, 3.9861233671306575],
               [-69.22310368050964, 3.9861233671306575],
               [-69.22310368050964, 3.9871508431701064]]],
             [[[-69.22482029427917, 3.988863300381725],
               [-69.22482029427917, 3.988178317925272],
               [-69.2239619873944, 3.988178317925272],
               [-69.2239619873944, 3.988863300381725]]],
             [[[-67.7787043721952, 4.354096185439464],
               [-67.7787043721952, 4.352726856636845],
               [-67.77767440393347, 4.352726856636845],
               [-67.77767440393347, 4.354096185439464]]],
             [[[-67.80994674280066, 4.341686552229325],
               [-67.80994674280066, 4.341001876865528],
               [-67.80891677453894, 4.341001876865528],
               [-67.80891677453894, 4.341686552229325]]],
             [[[-67.82711288049597, 4.32662355090645],
               [-67.82711288049597, 4.325254172277375],
               [-67.8255679281034, 4.325254172277375],
               [-67.8255679281034, 4.32662355090645]]],
             [[[-67.82625457361121, 4.330902843159196],
               [-67.82625457361121, 4.3288487858971845],
               [-67.82453795984168, 4.3288487858971845],
               [-67.82453795984168, 4.330902843159196]]],
             [[[-69.3213875283285, 4.01863859870643],
               [-69.3213875283285, 4.018296120006447],
               [-69.32113003626307, 4.018296120006447],
               [-69.32113003626307, 4.01863859870643]]],
             [[[-69.32130169764002, 4.0068230005309236],
               [-69.32130169764002, 4.006394895940685],
               [-69.3210442055746, 4.006394895940685],
               [-69.3210442055746, 4.0068230005309236]]],
             [[[-68.52830488425457, 4.800654906009064],
               [-68.52830488425457, 4.79894431214333],
               [-68.52624494773113, 4.79894431214333],
               [-68.52624494773113, 4.800654906009064]]],
             [[[-68.52109510642254, 4.797575833963598],
               [-68.52109510642254, 4.796549473528487],
               [-68.52006513816082, 4.796549473528487],
               [-68.52006513816082, 4.797575833963598]]],
             [[[-68.59834272605144, 4.771916361007907],
               [-68.59834272605144, 4.770205695311725],
               [-68.59696943503582, 4.770205695311725],
               [-68.59696943503582, 4.771916361007907]]],
             [[[-68.59696943503582, 4.778074722200219],
               [-68.59696943503582, 4.776706202269727],
               [-68.59559614402019, 4.776706202269727],
               [-68.59559614402019, 4.778074722200219]]],
             [[[-68.59113294821941, 4.7736270224404285],
               [-68.59113294821941, 4.773284890495101],
               [-68.5904463027116, 4.773284890495101],
               [-68.5904463027116, 4.7736270224404285]]],
             [[[-68.59971601706707, 4.768495025353384],
               [-68.59971601706707, 4.766442215779477],
               [-68.59731275778972, 4.766442215779477],
               [-68.59731275778972, 4.768495025353384]]],
             [[[-68.43938429099285, 4.83965527944533],
               [-68.43938429099285, 4.8376026840888535],
               [-68.43663770896161, 4.8376026840888535],
               [-68.43663770896161, 4.83965527944533]]],
             [[[-70.22539313636938, 4.326182367399704],
               [-70.22539313636938, 4.323785951778689],
               [-70.22230323158422, 4.323785951778689],
               [-70.22230323158422, 4.326182367399704]]],
             [[[-70.1013654785835, 4.4443922500400355],
               [-70.1013654785835, 4.443793241620431],
               [-70.10076466376417, 4.443793241620431],
               [-70.10076466376417, 4.4443922500400355]]],
             [[[-70.10188046271436, 4.445932555169496],
               [-70.10188046271436, 4.44524797550939],
               [-70.10127964789503, 4.44524797550939],
               [-70.10127964789503, 4.445932555169496]]],
             [[[-70.10196629340284, 4.449098727823451],
               [-70.10196629340284, 4.447986290333656],
               [-70.1010221558296, 4.447986290333656],
               [-70.1010221558296, 4.449098727823451]]],
             [[[-70.10625782782667, 4.4520081717734294],
               [-70.10625782782667, 4.45089573867981],
               [-70.105056198188, 4.45089573867981],
               [-70.105056198188, 4.4520081717734294]]],
             [[[-70.12231243065196, 4.457314299249197],
               [-70.12231243065196, 4.456972014791985],
               [-70.12128246239024, 4.456972014791985],
               [-70.12128246239024, 4.457314299249197]]],
             [[[-70.11407268455821, 4.454747161935621],
               [-70.11407268455821, 4.4540625904717155],
               [-70.11235607078868, 4.4540625904717155],
               [-70.11235607078868, 4.454747161935621]]],
             [[[-70.12317073753673, 4.477508799677278],
               [-70.12317073753673, 4.475797422916217],
               [-70.12231243065196, 4.475797422916217],
               [-70.12231243065196, 4.477508799677278]]],
             [[[-70.12385738304454, 4.472203518695542],
               [-70.12385738304454, 4.4718612411833005],
               [-70.12351406029063, 4.4718612411833005],
               [-70.12351406029063, 4.472203518695542]]],
             [[[-70.11269939354258, 4.476653111797004],
               [-70.11269939354258, 4.4752840091075745],
               [-70.11201274803477, 4.4752840091075745],
               [-70.11201274803477, 4.476653111797004]]],
             [[[-70.10188472679454, 4.4759685607724125],
               [-70.10188472679454, 4.474599456802605],
               [-70.10085475853282, 4.474599456802605],
               [-70.10085475853282, 4.4759685607724125]]],
             [[[-70.09124172142344, 4.477508799677278],
               [-70.09124172142344, 4.4763108363647435],
               [-70.08935344627696, 4.4763108363647435],
               [-70.08935344627696, 4.477508799677278]]],
             [[[-70.05067710372165, 4.458178434693633],
               [-70.05067710372165, 4.457322724257781],
               [-70.04999045821384, 4.457322724257781],
               [-70.04999045821384, 4.458178434693633]]],
             [[[-70.05582694503025, 4.45971871096704],
               [-70.05582694503025, 4.458863002324894],
               [-70.05479697676853, 4.458863002324894],
               [-70.05479697676853, 4.45971871096704]]],
             [[[-69.84179166842407, 4.411824767118077],
               [-69.84179166842407, 4.409086318442521],
               [-69.83698514986938, 4.409086318442521],
               [-69.83698514986938, 4.411824767118077]]],
             [[[-69.65365931449728, 4.416991453466225],
               [-69.65365931449728, 4.415279936139366],
               [-69.6495394414504, 4.415279936139366],
               [-69.6495394414504, 4.416991453466225]]],
             [[[-69.65606257377462, 4.406379982438012],
               [-69.65606257377462, 4.4039838228463575],
               [-69.654689282759, 4.4039838228463575],
               [-69.654689282759, 4.406379982438012]]],
             [[[-69.65228602348165, 4.4074069056136755],
               [-69.65228602348165, 4.404668440660257],
               [-69.6498827642043, 4.404668440660257],
               [-69.6498827642043, 4.4074069056136755]]],
             [[[-69.65056940971212, 4.410829972618369],
               [-69.65056940971212, 4.409460747708784],
               [-69.6491961186965, 4.409460747708784],
               [-69.6491961186965, 4.410829972618369]]],
             [[[-69.65194270072774, 4.4142530238482856],
               [-69.65194270072774, 4.412541500205939],
               [-69.6498827642043, 4.412541500205939],
               [-69.6498827642043, 4.4142530238482856]]],
             [[[-69.03351475211699, 4.36911916486176],
               [-69.03351475211699, 4.366038233145921],
               [-69.03042484733183, 4.366038233145921],
               [-69.03042484733183, 4.36911916486176]]],
             [[[-69.01909519645292, 4.374596345541835],
               [-69.01909519645292, 4.370488463784136],
               [-69.01394535514433, 4.370488463784136],
               [-69.01394535514433, 4.374596345541835]]],
             [[[-68.8587634703787, 4.492726816996807],
               [-68.8587634703787, 4.488961861248359],
               [-68.85567356559355, 4.488961861248359],
               [-68.85567356559355, 4.492726816996807]]],
             [[[-68.86206881747157, 4.554802125630322],
               [-68.86206881747157, 4.550695252107046],
               [-68.8582922671786, 4.550695252107046],
               [-68.8582922671786, 4.554802125630322]]],
             [[[-68.3295492391289, 4.812620431183266],
               [-68.3295492391289, 4.809199299221782],
               [-68.32577268883593, 4.809199299221782],
               [-68.32577268883593, 4.812620431183266]]],
             [[[-68.33881895348436, 4.80748872679529],
               [-68.33881895348436, 4.805778150073662],
               [-68.33675901696093, 4.805778150073662],
               [-68.33675901696093, 4.80748872679529]]],
             [[[-68.32027952477343, 4.813646767418516],
               [-68.32027952477343, 4.810909867351612],
               [-68.31272642418749, 4.810909867351612],
               [-68.31272642418749, 4.813646767418516]]],
             [[[-68.3020834188164, 4.870434950227988],
               [-68.3020834188164, 4.8683824485101965],
               [-68.29865019127733, 4.8683824485101965],
               [-68.29865019127733, 4.870434950227988]]],
             [[[-68.29384367272264, 4.80748872679529],
               [-68.29384367272264, 4.805436034214053],
               [-68.29075376793749, 4.805436034214053],
               [-68.29075376793749, 4.80748872679529]]],
             [[[-68.27221433922655, 4.807830841624259],
               [-68.27221433922655, 4.80475180197965],
               [-68.26775114342577, 4.80475180197965],
               [-68.26775114342577, 4.807830841624259]]],
             [[[-68.44284574791796, 4.83964676807779],
               [-68.44284574791796, 4.8379362723581725],
               [-68.44147245690233, 4.8379362723581725],
               [-68.44147245690233, 4.83964676807779]]],
             [[[-70.00048203682265, 4.032730063425639],
               [-70.00048203682265, 4.031702644675474],
               [-69.99962372993788, 4.031702644675474],
               [-69.99962372993788, 4.032730063425639]]],
             [[[-69.99722047066054, 4.029647803279855],
               [-69.99722047066054, 4.028620380635062],
               [-69.99584717964491, 4.028620380635062],
               [-69.99584717964491, 4.029647803279855]]],
             [[[-69.99464555000624, 4.027935431484309],
               [-69.99464555000624, 4.0266511502726265],
               [-69.99361558174452, 4.0266511502726265],
               [-69.99361558174452, 4.027935431484309]]],
             [[[-69.98117013191542, 4.025195629116324],
               [-69.98117013191542, 4.02442505803896],
               [-69.9801401636537, 4.02442505803896],
               [-69.9801401636537, 4.025195629116324]]],
             [[[-70.00451607918104, 4.0352986046177435],
               [-70.00451607918104, 4.034528043112795],
               [-70.0032286188539, 4.034528043112795],
               [-70.0032286188539, 4.0352986046177435]]],
             [[[-70.0076059839662, 4.037867137686764],
               [-70.0076059839662, 4.0370109608999565],
               [-70.00666184639296, 4.0370109608999565],
               [-70.00666184639296, 4.037867137686764]]],
             [[[-70.01009507393202, 4.039237018667033],
               [-70.01009507393202, 4.038295225741488],
               [-70.0090651056703, 4.038295225741488],
               [-70.0090651056703, 4.039237018667033]]],
             [[[-70.01352830147108, 4.04043566262757],
               [-70.01352830147108, 4.039750723438403],
               [-70.01249833320936, 4.039750723438403],
               [-70.01249833320936, 4.04043566262757]]],
             [[[-70.0142149469789, 4.038980166159381],
               [-70.0142149469789, 4.038466460900165],
               [-70.01335664009413, 4.038466460900165],
               [-70.01335664009413, 4.038980166159381]]],
             [[[-70.01704735969862, 4.041206218524031],
               [-70.01704735969862, 4.040778132005259],
               [-70.01627488350233, 4.040778132005259],
               [-70.01627488350233, 4.041206218524031]]],
             [[[-70.01833482002577, 4.043261030668216],
               [-70.01833482002577, 4.042404859574347],
               [-70.01696152901015, 4.042404859574347],
               [-70.01696152901015, 4.043261030668216]]],
             [[[-69.96984048103651, 4.020400952792222],
               [-69.96984048103651, 4.019715996728762],
               [-69.9691538355287, 4.019715996728762],
               [-69.9691538355287, 4.020400952792222]]],
             [[[-69.9662355921205, 4.018517322233158],
               [-69.9662355921205, 4.018003604052837],
               [-69.96572060798964, 4.018003604052837],
               [-69.96572060798964, 4.018517322233158]]],
             [[[-69.9610857508119, 4.016291207782032],
               [-69.9610857508119, 4.015691868238238],
               [-69.96031327461561, 4.015691868238238],
               [-69.96031327461561, 4.016291207782032]]],
             [[[-69.00825430492814, 4.455930331032796],
               [-69.00825430492814, 4.45456118967048],
               [-69.00653769115861, 4.45456118967048],
               [-69.00653769115861, 4.455930331032796]]],
             [[[-69.00207449535783, 4.457641754150277],
               [-69.00207449535783, 4.45456118967048],
               [-68.99898459057268, 4.45456118967048],
               [-68.99898459057268, 4.457641754150277]]],
             [[[-69.00516440014299, 4.452165186153898],
               [-69.00516440014299, 4.450796037784298],
               [-69.00310446361955, 4.450796037784298],
               [-69.00310446361955, 4.452165186153898]]],
             [[[-68.99829794506486, 4.44258109411426],
               [-68.99829794506486, 4.441554219717657],
               [-68.99383474926408, 4.441554219717657],
               [-68.99383474926408, 4.44258109411426]]],
             [[[-69.0058510456508, 4.446346287999323],
               [-69.0058510456508, 4.443607967081],
               [-69.00447775463518, 4.443607967081],
               [-69.00447775463518, 4.446346287999323]]],
             [[[-68.98490835766252, 4.437789001368785],
               [-68.98490835766252, 4.434708353890161],
               [-68.98216177563127, 4.434708353890161],
               [-68.98216177563127, 4.437789001368785]]],
             [[[-68.9835350666469, 4.429231615548184],
               [-68.9835350666469, 4.428547020403191],
               [-68.98284842113908, 4.428547020403191],
               [-68.98284842113908, 4.429231615548184]]],
             [[[-68.9842217121547, 4.450453750293956],
               [-68.9842217121547, 4.448057733405928],
               [-68.98216177563127, 4.448057733405928],
               [-68.98216177563127, 4.450453750293956]]],
             [[[-68.9505760822719, 4.456272615975043],
               [-68.9505760822719, 4.452165186153898],
               [-68.94851614574846, 4.452165186153898],
               [-68.94851614574846, 4.456272615975043]]],
             [[[-68.89392782787736, 4.462433717673047],
               [-68.89392782787736, 4.458326322281483],
               [-68.88946463207658, 4.458326322281483],
               [-68.88946463207658, 4.462433717673047]]],
             [[[-68.89736105541643, 4.4768094204439395],
               [-68.89736105541643, 4.47407121308923],
               [-68.89358450512346, 4.47407121308923],
               [-68.89358450512346, 4.4768094204439395]]],
             [[[-68.88328482250627, 4.480574438826225],
               [-68.88328482250627, 4.479889891470974],
               [-68.88019491772111, 4.479889891470974],
               [-68.88019491772111, 4.480574438826225]]],
             [[[-68.88225485424455, 4.477151695643028],
               [-68.88225485424455, 4.473728936449809],
               [-68.87676169018205, 4.473728936449809],
               [-68.87676169018205, 4.477151695643028]]],
             [[[-67.82574294634198, 4.4809447615318545],
               [-67.82574294634198, 4.480089077671012],
               [-67.82505630083416, 4.480089077671012],
               [-67.82505630083416, 4.4809447615318545]]],
             [[[-67.82488463945721, 4.478548844198406],
               [-67.82488463945721, 4.477693157534465],
               [-67.8241979939494, 4.477693157534465],
               [-67.8241979939494, 4.478548844198406]]],
             [[[-67.82642959184979, 4.481971580842891],
               [-67.82642959184979, 4.481458171367653],
               [-67.82608626909588, 4.481458171367653],
               [-67.82608626909588, 4.481971580842891]]],
             [[[-67.89028762407635, 4.467082559819406],
               [-67.89028762407635, 4.465713439247143],
               [-67.88891433306073, 4.465713439247143],
               [-67.88891433306073, 4.467082559819406]]],
             [[[-67.8871977192912, 4.4646865971411085],
               [-67.8871977192912, 4.463659753598151],
               [-67.88685439653729, 4.463659753598151],
               [-67.88685439653729, 4.4646865971411085]]],
             [[[-67.86193228345364, 4.895107962783002],
               [-67.86193228345364, 4.893397608029092],
               [-67.86021566968411, 4.893397608029092],
               [-67.86021566968411, 4.895107962783002]]],
             [[[-67.91171408277005, 4.8988707278476475],
               [-67.91171408277005, 4.896476243437872],
               [-67.90862417798489, 4.896476243437872],
               [-67.90862417798489, 4.8988707278476475]]],
             [[[-67.86742544751614, 4.868083847409323],
               [-67.86742544751614, 4.865689253094208],
               [-67.86296225171536, 4.865689253094208],
               [-67.86296225171536, 4.868083847409323]]]], null, false),
        {
          "id": 6,
          "system:index": "0"
        }),
    id_27 = 
    /* color: #5a6e4d */
    /* displayProperties: [
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      }
    ] */
    ee.Feature(
        ee.Geometry.MultiPolygon(
            [[[[-68.32252238295564, 4.778421293984953],
               [-68.32252238295564, 4.774999990766756],
               [-68.31805918715486, 4.774999990766756],
               [-68.31805918715486, 4.778421293984953]]],
             [[[-68.10777410466548, 4.658681294870424],
               [-68.10777410466548, 4.658253559127611],
               [-68.1073449512231, 4.658253559127611],
               [-68.1073449512231, 4.658681294870424]]],
             [[[-68.10631498296138, 4.657398086861452],
               [-68.10631498296138, 4.656542613554716],
               [-68.10571416814204, 4.656542613554716],
               [-68.10571416814204, 4.657398086861452]]],
             [[[-67.82559009589008, 4.488071605695159],
               [-67.82559009589008, 4.48670252439146],
               [-67.82473178900531, 4.48670252439146],
               [-67.82473178900531, 4.488071605695159]]],
             [[[-67.82026859320453, 4.487558200507142],
               [-67.82026859320453, 4.486360253664411],
               [-67.81941028631977, 4.486360253664411],
               [-67.81941028631977, 4.487558200507142]]],
             [[[-67.82009693182758, 4.480028216289687],
               [-67.82009693182758, 4.479001394249569],
               [-67.8188953021889, 4.479001394249569],
               [-67.8188953021889, 4.480028216289687]]],
             [[[-69.2426730774823, 3.980300978664191],
               [-69.2426730774823, 3.978759751294048],
               [-69.24095646371276, 3.978759751294048],
               [-69.24095646371276, 3.980300978664191]]],
             [[[-69.2514278077069, 3.98201345013654],
               [-69.2514278077069, 3.980985967680577],
               [-69.25005451669128, 3.980985967680577],
               [-69.25005451669128, 3.98201345013654]]],
             [[[-69.25743595590026, 3.9765335288911308],
               [-69.25743595590026, 3.974992294474137],
               [-69.25537601937683, 3.974992294474137],
               [-69.25537601937683, 3.9765335288911308]]],
             [[[-69.27701958168826, 3.964822028649588],
               [-69.27701958168826, 3.9637945247819526],
               [-69.2758179520496, 3.9637945247819526],
               [-69.2758179520496, 3.964822028649588]]],
             [[[-69.30860527504764, 3.949580590426659],
               [-69.30860527504764, 3.947696797704037],
               [-69.3062020157703, 3.947696797704037],
               [-69.3062020157703, 3.949580590426659]]],
             [[[-71.17332397161739, 3.6282866506181146],
               [-71.17332397161739, 3.6278155279198545],
               [-71.1725514954211, 3.6278155279198545],
               [-71.1725514954211, 3.6282866506181146]]],
             [[[-71.16894660650509, 3.629785675750933],
               [-71.16894660650509, 3.6294858709233777],
               [-71.16856036840694, 3.6294858709233777],
               [-71.16856036840694, 3.629785675750933]]],
             [[[-71.16208015142696, 3.6266163053978593],
               [-71.16208015142696, 3.6255455696588776],
               [-71.16126475988644, 3.6255455696588776],
               [-71.16126475988644, 3.6266163053978593]]],
             [[[-71.14190993963497, 3.6320984525037012],
               [-71.14190993963497, 3.629271724557044],
               [-71.14066539465206, 3.629271724557044],
               [-71.14066539465206, 3.6320984525037012]]],
             [[[-71.13800464330929, 3.6222905252282],
               [-71.13800464330929, 3.620962806374734],
               [-71.13349853216427, 3.620962806374734],
               [-71.13349853216427, 3.6222905252282]]],
             [[[-71.1401504105212, 3.6246889801548097],
               [-71.1401504105212, 3.622376184442182],
               [-71.1375754898669, 3.622376184442182],
               [-71.1375754898669, 3.6246889801548097]]],
             [[[-71.12710414587276, 3.6254141309595544],
               [-71.12710414587276, 3.6204458998251474],
               [-71.11834941564815, 3.6204458998251474],
               [-71.11834941564815, 3.6254141309595544]]],
             [[[-71.31658755913128, 3.5756293536334582],
               [-71.31658755913128, 3.5697185457906246],
               [-71.306631199268, 3.5697185457906246],
               [-71.306631199268, 3.5756293536334582]]],
             [[[-71.31221019401897, 3.578798901569024],
               [-71.31221019401897, 3.574087407432347],
               [-71.30345546379436, 3.574087407432347],
               [-71.30345546379436, 3.578798901569024]]],
             [[[-71.20739430292565, 3.573083023413713],
               [-71.20739430292565, 3.549182500463185],
               [-71.19048565729577, 3.549182500463185],
               [-71.19048565729577, 3.573083023413713]]],
             [[[-69.3433601845785, 4.015556285230479],
               [-69.3433601845785, 4.006394895940685],
               [-69.3338329781576, 4.006394895940685],
               [-69.3338329781576, 4.015556285230479]]],
             [[[-69.39258873513626, 3.9871081622875826],
               [-69.39258873513626, 3.9856525707771673],
               [-69.39078629067825, 3.9856525707771673],
               [-69.39078629067825, 3.9871081622875826]]],
             [[[-69.38057243874954, 3.986594424401702],
               [-69.38057243874954, 3.9841969766902103],
               [-69.37662422707962, 3.9841969766902103],
               [-69.37662422707962, 3.986594424401702]]],
             [[[-69.38992798379348, 3.9733227512004534],
               [-69.38992798379348, 3.9706683909136204],
               [-69.38786804727005, 3.9706683909136204],
               [-69.38786804727005, 3.9733227512004534]]],
             [[[-69.39713776162552, 3.97597710294597],
               [-69.39713776162552, 3.9742646189268167],
               [-69.39542114785598, 3.9742646189268167],
               [-69.39542114785598, 3.97597710294597]]],
             [[[-69.40074265054153, 3.97837457459578],
               [-69.40074265054153, 3.9774327115651866],
               [-69.39919769814895, 3.9774327115651866],
               [-69.39919769814895, 3.97837457459578]]],
             [[[-69.39524948647903, 3.961849003535979],
               [-69.39524948647903, 3.958509599298004],
               [-69.39267456582473, 3.958509599298004],
               [-69.39267456582473, 3.961849003535979]]],
             [[[-68.86288334342558, 4.409290830838511],
               [-68.86288334342558, 4.4003908054251015],
               [-68.85361362907011, 4.4003908054251015],
               [-68.85361362907011, 4.409290830838511]]],
             [[[-68.86013676139433, 4.424352169347807],
               [-68.86013676139433, 4.40518314003484],
               [-68.8477771422537, 4.40518314003484],
               [-68.8477771422537, 4.424352169347807]]],
             [[[-68.86082340690214, 4.433936498062123],
               [-68.86082340690214, 4.419559958455133],
               [-68.84983707877714, 4.419559958455133],
               [-68.84983707877714, 4.433936498062123]]],
             [[[-68.85498692008574, 4.442836120559596],
               [-68.85498692008574, 4.427432859975794],
               [-68.84400059196074, 4.427432859975794],
               [-68.84400059196074, 4.442836120559596]]],
             [[[-68.84812046500761, 4.449681910944093],
               [-68.84812046500761, 4.437017148760181],
               [-68.83404423209745, 4.437017148760181],
               [-68.83404423209745, 4.449681910944093]]],
             [[[-68.85704685660917, 4.435647972258397],
               [-68.85704685660917, 4.429144349227911],
               [-68.85086704703886, 4.429144349227911],
               [-68.85086704703886, 4.435647972258397]]],
             [[[-68.84468723746855, 4.455843067871806],
               [-68.84468723746855, 4.446259023702073],
               [-68.8364474913748, 4.446259023702073],
               [-68.8364474913748, 4.455843067871806]]],
             [[[-68.84125400992949, 4.468507506011876],
               [-68.84125400992949, 4.454816211967202],
               [-68.83473087760527, 4.454816211967202],
               [-68.83473087760527, 4.468507506011876]]],
             [[[-68.95093385571202, 4.007001649556214],
               [-68.95093385571202, 4.005631714378045],
               [-68.95007554882726, 4.005631714378045],
               [-68.95007554882726, 4.007001649556214]]],
             [[[-68.94338075512609, 4.008714065302242],
               [-68.94338075512609, 4.007515374656518],
               [-68.94252244824132, 4.007515374656518],
               [-68.94252244824132, 4.008714065302242]]],
             [[[-68.95162050121984, 4.011453923035046],
               [-68.95162050121984, 4.0088853066795895],
               [-68.95024721020421, 4.0088853066795895],
               [-68.95024721020421, 4.011453923035046]]],
             [[[-68.88089601391515, 3.993130950016993],
               [-68.88089601391515, 3.9917609916512067],
               [-68.87883607739171, 3.9917609916512067],
               [-68.87883607739171, 3.993130950016993]]],
             [[[-68.8891357600089, 3.9897060498169026],
               [-68.8891357600089, 3.9878223486196647],
               [-68.88759080761632, 3.9878223486196647],
               [-68.88759080761632, 3.9897060498169026]]],
             [[[-68.89102403515538, 3.985424904488434],
               [-68.89102403515538, 3.984054933275166],
               [-68.88862077587804, 3.984054933275166],
               [-68.88862077587804, 3.985424904488434]]],
             [[[-68.86836473339757, 3.9855961507296507],
               [-68.86836473339757, 3.984054933275166],
               [-68.86630479687413, 3.984054933275166],
               [-68.86630479687413, 3.9855961507296507]]],
             [[[-68.87471620434484, 3.981314984005159],
               [-68.87471620434484, 3.97874627328211],
               [-68.8729995905753, 3.97874627328211],
               [-68.8729995905753, 3.981314984005159]]],
             [[[-68.8671631037589, 3.9799450059499843],
               [-68.8671631037589, 3.9746363194666223],
               [-68.86235658520421, 3.9746363194666223],
               [-68.86235658520421, 3.9799450059499843]]],
             [[[-67.87438476039698, 4.748250101568595],
               [-67.87438476039698, 4.7461972316288925],
               [-67.8724964852505, 4.7461972316288925],
               [-67.8724964852505, 4.748250101568595]]],
             [[[-67.8838261361294, 4.732853428282483],
               [-67.8838261361294, 4.731655894877166],
               [-67.88296782924463, 4.731655894877166],
               [-67.88296782924463, 4.732853428282483]]],
             [[[-67.88279616786768, 4.7289186678863135],
               [-67.88279616786768, 4.727378972949768],
               [-67.88073623134424, 4.727378972949768],
               [-67.88073623134424, 4.7289186678863135]]],
             [[[-67.81406997270916, 4.480602488107682],
               [-67.81406997270916, 4.477864294947317],
               [-67.81132339067791, 4.477864294947317],
               [-67.81132339067791, 4.480602488107682]]],
             [[[-67.81286834307049, 4.445518614427317],
               [-67.81286834307049, 4.443636017774725],
               [-67.81115172930096, 4.443636017774725],
               [-67.81115172930096, 4.445518614427317]]],
             [[[-67.81183837480877, 4.436961318194621],
               [-67.81183837480877, 4.435934435978637],
               [-67.8106367451701, 4.435934435978637],
               [-67.8106367451701, 4.436961318194621]]],
             [[[-67.86488174028729, 4.466911419887619],
               [-67.86488174028729, 4.465371158704812],
               [-67.86385177202557, 4.465371158704812],
               [-67.86385177202557, 4.466911419887619]]],
             [[[-67.87758468218182, 4.462119485590191],
               [-67.87758468218182, 4.458525514340942],
               [-67.87518142290448, 4.458525514340942],
               [-67.87518142290448, 4.462119485590191]]],
             [[[-68.41539082485862, 4.35500270648159],
               [-68.41539082485862, 4.353119881003661],
               [-68.41281590420432, 4.353119881003661],
               [-68.41281590420432, 4.35500270648159]]]], null, false),
        {
          "id": 27,
          "system:index": "0"
        }),
    geometry = /* color: #0b4a8b */ee.Geometry.MultiLineString(
        [[[-70.36228966873284, 4.179630488812001],
          [-70.30186486404534, 3.22034178513976]],
         [[-69.90086388748284, 4.612312761635852],
          [-69.84043908279534, 3.4725962479235997]],
         [[-69.36253380935784, 4.7984507914052825],
          [-69.32957482498284, 3.5329081681009984]],
         [[-68.59898400467034, 5.12680465719217],
          [-68.57151818435784, 3.5603213856146527]]]),
    Dudas = 
    /* color: #ffc82d */
    /* displayProperties: [
      {
        "type": "marker"
      },
      {
        "type": "marker"
      },
      {
        "type": "marker"
      },
      {
        "type": "marker"
      },
      {
        "type": "marker"
      },
      {
        "type": "marker"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "marker"
      },
      {
        "type": "marker"
      }
    ] */
    ee.Geometry({
      "type": "GeometryCollection",
      "geometries": [
        {
          "type": "Point",
          "coordinates": [
            -68.10434087712642,
            4.659964500537503
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            -67.83488626320953,
            4.784819833305013
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            -67.99431948364995,
            4.595893018364002
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            -68.77598527171713,
            4.165088460137232
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            -68.8508296320687,
            4.1257096366281605
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            -71.10214436474826,
            3.6101891720033423
          ]
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -69.47772333452151,
                4.064626172930179
              ],
              [
                -69.47772333452151,
                4.064626172930179
              ],
              [
                -69.46673700639651,
                4.064626172930179
              ],
              [
                -69.46673700639651,
                4.064626172930179
              ]
            ]
          ],
          "geodesic": false,
          "evenOdd": true
        },
        {
          "type": "Point",
          "coordinates": [
            -67.8938664858192,
            4.735934065024674
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            -67.8664006655067,
            4.771516807848445
          ]
        }
      ],
      "coordinates": []
    }),
    clase11 = /* color: #00ffff */ee.Geometry.MultiPoint(
        [[-70.30265761066725, 4.274486583589589],
         [-70.26557875324538, 4.300506091996797],
         [-70.28652144123366, 4.301533159660911],
         [-70.33149672199538, 4.279622083004762],
         [-70.24188948322585, 4.3124884618459305],
         [-70.22335005451491, 4.309064946862719],
         [-70.22472334553053, 4.313857863520694],
         [-70.23124647785475, 4.311461408970122]]);
/***** End of imports. If edited, may not auto-convert in the playground. *****/
/**** Start of imports. If edited, may not auto-convert in the playground. ****/

/***** End of imports. If edited, may not auto-convert in the playground. *****/


var country            = 'COLOMBIA';

var regionId           = 30201;

var preview            = [
1985, 1986, 1987,
// 1988, 1989, 1990, 
// 1991, 1993, 1992, 
// 1994, 1995,
//   1996, 1997, 
// 1998, 1999, 
//   2000,
// 2001, 
// 2002, 2003, 2004,
//   2005, 2006,
//   2007, 2008, 2009, 
//   2010, 2011, 2012, 
//   2013, 2014, 2015,
//   2016, 2017,
//   2018, 
// 2019, 
// 2020, 
// 2021
   ];

var version            = 2;

var remapAreas         = [ remap ];

var includeAreas       = [ include ]

var additionalSamples  = {
  polygons: [ id_6, id_27 ],
  classes:  [ 6 , 27],
  points:   [3000, 7500]
};

var years              = [
 1985, 1986, 1987,
  1988, 1989, 1990, 
 1991, 1993, 1992, 
 1994, 1995,
 1996, 1997, 
 1998, 1999, 
  2000,
 2001, 
 2002, 2003, 2004,
  2005, 2006,
   2007, 2008, 2009, 
  2010, 2011, 2012, 
  2013, 2014, 2015,
  2016, 2017,
  2018, 
 2019, 
  2020, 
2021
];

var featurespace       = [
  // altitude
  "altitude",
  "slope",
  
  // spectral
  "mndwi_median",
  "ndsi_median",
  "gcvi_median",
  "ndwi_mcfeeters_median",
  "gcvi_wet",
  "mndwi_wet",
  "mndwi_max",
  "ndsi_min",
  "ndvi_median",
  "ndvi_wet",
  "ndbi_median",
  "ndsi2_median",
  "ndwi_gao_median",
  "ndmi_median",
  "mndwi_dry",
  "ndmir_median",
  "mmri_median",
  "cai_median",
  "red_wet_max",
  "savi_median",
  "red_wet",
  "evi2_median",
  "clay_median",
  "gcvi_dry",
  "ndmir_wet",
  "ndfib_median",
  "ndbi_max",
  "ndsi2_max",
  "green_wet_qmo",
  "green_median",
  "red_median",
  "ndwi_gao_dry",
  "ndmir_max",
  "ndmi_dry",
  "ndsi2_dry",
  "cai_wet_min",
  "ndrb_wet",
  "ndbi_dry",
  "red_min",
  "ndwi_gao_wet_min",
  "gvs_median",
  "cai_min",
  "gv_median",
  "ndwi_gao_dry_min",
  "ndvi_dry",
  "savi_dry",
  
  // tcap
  "brightness", 
  "greeness",
  "wetness",
];

/**
 * Asset locations, paths and visualization config
 */
var commonPath   = 'projects/mapbiomas-raisg';

var samplesPath  = 'projects/mapbiomas-raisg/MUESTRAS';

var stablePath   = commonPath + '/DATOS_AUXILIARES/RASTERS/wetlands-stables-3';

var accumulPath  = commonPath + '/DATOS_AUXILIARES/RASTERS/wetlands-accumulated-3';

var mosaicsPath  = commonPath + '/MOSAICOS/mosaics-2';
//var mosaicsPath  = 'projects/nexgenmap/MapBiomas2/LANDSAT/PANAMAZON/mosaics-2'

var roiPath      = samplesPath + '/' + country + '/COLECCION5/TRANSVERSALES/INUNDABLE/STEP1_ROI/FLOODED-ROI-' + country + '-' + regionId + '-1';

var samlesPath   = samplesPath + '/' + country + '/COLECCION5/TRANSVERSALES/INUNDABLE/STEP2_PUNTOS';

var outputPath   = commonPath + '/TRANSVERSALES/' + country + '/COLECCION5/INUNDABLE/clasificacion';

var slpposPath   = commonPath + '/MOSAICOS/slppost2_30_v1';

var altitudePath = 'JAXA/ALOS/AW3D30_V1_1';

var vRegionsPath = commonPath + '/DATOS_AUXILIARES/VECTORES/' + country + '/ClasificacionRegionesInundables';

var rRegionsPath = commonPath + '/DATOS_AUXILIARES/RASTERS/' + country + '/col_ref_inundable11_noraisg';

var col3Path     = commonPath + '/public/collection3/mapbiomas_raisg_panamazonia_collection3_integration_v2';

var palette      = require('users/mapbiomas/modules:Palettes.js').get('classification6');

// Visualization parameters
var referenceVis = { min: 0, max: 49, palette: palette};

var mosaicbands  = [ 'swir1_median', 'nir_median', 'red_median'];

var mosaicbands2  = [ 'nir_median', 'swir1_median', 'red_median'];

var mosaicbands3  = [ 'mmri_median'];

var mosaicbands4  = [ 'brightness'];

var mosaicbands5  = [ 'clay_median']; // 

var mosaicbands6  = [ 'altitude'];

var mosaicVis    = { bands: mosaicbands, min: 100, max: 4500};

var mosaicVis2    = { bands: mosaicbands2, gain:[0.06, 0.08, 0.2] };

var mosaicVis3    = { bands: mosaicbands3, min: 35, max: 50};

var mosaicVis4    = { bands: mosaicbands4, min: 2000, max: 3500};

var mosaicVis5    = { bands: mosaicbands5, min: 300, max: 390};

var mosaicVis6    = { bands: mosaicbands6, min: 23, max: 371};


var pointsVis    = { styleProperty: "style", width: 0.5 };


/**
 * Assets loading
 */
var mosaicreg   = parseInt(regionId.toString().slice(0, 3), 10);
 
var mosaics     = ee.ImageCollection(mosaicsPath);
 
var stables     = ee.Image(stablePath);

var accumulated = ee.Image(accumulPath);

var vRegions    = ee.FeatureCollection(vRegionsPath);

var rRegions    = ee.Image(rRegionsPath).rename('regionid');

var collection3 = ee.Image(col3Path);

var region      = getRegion(vRegions, rRegions, regionId);

var roi         = ee.Image(roiPath);

var reference   = getReference(roi, region.vector, stables, accumulated);

roi             = includeNewArea(roi, includeAreas);

roi             = spatialFilter(roi, 8);




function includeNewArea(image, included) {
  if(included && included.length > 0) {
    
    var includedAreas = ee.FeatureCollection(included)
      .map(function(item) { return item.set('version', 1)})
      .reduceToImage(['version'], ee.Reducer.first())
      .rename('constant')
      .byte()
    
    return ee.ImageCollection([image, includedAreas]).mosaic();
    
  }
  else {
    return image
  }
}


/**
 * 
 */
Map.addLayer(
  region.vector,
  {
    color: 'black',
    fillColor: '000000cc',
    width: 1
  },
  'REGION ' + regionId
);

 
ee.List(years)
  .evaluate(function(years) {
    
    var classified = ee.Image(27).updateMask(roi);
    
    years.forEach(function(year) {
      
      var yearMosaic  = getMosaic(mosaics, mosaicreg, year, []);
      var selected = yearMosaic.select(featurespace).updateMask(roi);
      
      ///
      var bands = selected.bandNames();
      
      var nBands = bands.size();
      
      var assetId = samlesPath + '/samples-FLOODED-' + country + '-' + regionId + '-' + year + '-1';
      
      var trainingSamples = ee.FeatureCollection(
        ee.Algorithms.If(
          ee.Algorithms.IsEqual(nBands, 0),
          null,
          ee.FeatureCollection(assetId)
        )
      );


      // Get the samples number of classes
      var nClasSample = trainingSamples
        .reduceColumns(ee.Reducer.toList(), ['reference'])
        .get('list');
        
      nClasSample = ee.List(nClasSample).reduce(ee.Reducer.countDistinct());


      // Here we put additional samples
      if(additionalSamples.polygons.length > 0){
        var newSamples = resampleCover(selected, additionalSamples);
        trainingSamples = trainingSamples.merge(newSamples);
      }


      // Classifier
      var classifier = ee.Classifier.smileRandomForest({
        numberOfTrees: 50, 
        variablesPerSplit: 1
      });
      
      classifier = ee.Classifier(
        ee.Algorithms.If(
          ee.Algorithms.IsEqual(nBands, 0),
          null, 
          ee.Algorithms.If(
            ee.Algorithms.IsEqual(nClasSample, 1),
            null,
            classifier.train(trainingSamples, 'reference', bands)
          )
        )
      );
      
      var name = 'classification_' + year;
      
      classified = ee.Image(
        ee.Algorithms.If(
          ee.Algorithms.IsEqual(nBands, 0),
          classified.addBands(ee.Image().updateMask(roi).rename(name)),
          ee.Algorithms.If(
            ee.Algorithms.IsEqual(nClasSample, 1),
            classified.addBands(ee.Image().updateMask(roi).rename(name)),
            classified.addBands(
              remapWithPolygons(
                spatialFilter(selected.classify(classifier), 8),
                remapAreas
              )
              .select(['reference'], [name])
            )
          )
        )
      );
      
    });
    
    
    Export.image.toAsset({
      image: classified
        .slice(1)
        .set({
          country: country,
          region: regionId,
          version: version,
        }),
      description: 'FLOODED-' + country + '-' + regionId + '-' + version,
      assetId: outputPath + '/FLOODED-' + country + '-' + regionId + '-' + version,
      pyramidingPolicy: {
        '.default': 'mode'
      },
      region: region.vector.geometry().bounds(),
      scale: 30,
      crs: 'EPSG:4326',
      maxPixels: 1e13
    });
    

    preview.forEach(function(yr) {
      
      var yearMosaic  = getMosaic(mosaics, mosaicreg, yr, []);
      
      Map.addLayer(
        yearMosaic.clip(region.vector),
        mosaicVis,
        'MOSAICO Green - ' + yr,
        false
      );
      
      Map.addLayer(
        yearMosaic.clip(region.vector),
        mosaicVis2,
        'MOSAICO Red - ' + yr,
        false
      );
      
        Map.addLayer(
        yearMosaic.clip(region.vector),
        mosaicVis3,
        'mmri_median' + yr,
        false
      );
      
              Map.addLayer(
        yearMosaic.clip(region.vector),
        mosaicVis4,
        'brightness' + yr,
        false
      );
      
              Map.addLayer(
        yearMosaic.clip(region.vector),
        mosaicVis5,
        'clay_median' + yr,
        false
      );
     
                   Map.addLayer(
        yearMosaic.clip(region.vector),
        mosaicVis6,
        'DEM' + yr,
        false
      ); 
      
      
      Map.addLayer(
        collection3
          .clip(region.vector)
          .select('classification_' + yr)
          .eq(6).selfMask().multiply(6),
        referenceVis,
        'COLLECCION 3 - ' + yr, false 
      );
      
      
      Map.addLayer(
        classified.select('classification_' + yr),
        referenceVis,
        'COLLECTION 4 - ' + yr,false 
      );
    })
    

  
var dataset = ee.Image("UMD/hansen/global_forest_change_2021_v1_9");


// Map.addLayer(dataset.select('lossyear').eq(1).selfMask().clip(geometry2), {min:0,max:1,palette: ['red']}, 'deforestación 2001',false);
// Map.addLayer(dataset.select('lossyear').eq(2).selfMask().clip(geometry2), {min:0,max:1,palette: ['red']}, 'deforestación 2002',false);
// Map.addLayer(dataset.select('lossyear').eq(3).selfMask().clip(geometry2), {min:0,max:1,palette: ['red']}, 'deforestación 2003',false);
// Map.addLayer(dataset.select('lossyear').eq(4).selfMask().clip(geometry2), {min:0,max:1,palette: ['red']}, 'deforestación 2004',false);
// Map.addLayer(dataset.select('lossyear').eq(5).selfMask().clip(geometry2), {min:0,max:1,palette: ['red']}, 'deforestación 2005',false);
// Map.addLayer(dataset.select('lossyear').eq(6).selfMask().clip(geometry2), {min:0,max:1,palette: ['red']}, 'deforestación 2006',false);
// Map.addLayer(dataset.select('lossyear').eq(7).selfMask().clip(geometry2), {min:0,max:1,palette: ['red']}, 'deforestación 2007',false);
// Map.addLayer(dataset.select('lossyear').eq(8).selfMask().clip(geometry2), {min:0,max:1,palette: ['red']}, 'deforestación 2008',false);
// Map.addLayer(dataset.select('lossyear').eq(9).selfMask().clip(geometry2), {min:0,max:1,palette: ['red']}, 'deforestación 2009',false);
// Map.addLayer(dataset.select('lossyear').eq(10).selfMask().clip(geometry2), {min:0,max:1,palette: ['red']}, 'deforestación 2010',false);
// Map.addLayer(dataset.select('lossyear').eq(11).selfMask().clip(geometry2), {min:0,max:1,palette: ['red']}, 'deforestación 2011',false);
// Map.addLayer(dataset.select('lossyear').eq(12).selfMask().clip(geometry2), {min:0,max:1,palette: ['red']}, 'deforestación 2012',false);
// Map.addLayer(dataset.select('lossyear').eq(13).selfMask().clip(geometry2), {min:0,max:1,palette: ['red']}, 'deforestación 2013',false);
// Map.addLayer(dataset.select('lossyear').eq(14).selfMask().clip(geometry2), {min:0,max:1,palette: ['red']}, 'deforestación 2014',false);
// Map.addLayer(dataset.select('lossyear').eq(15).selfMask().clip(geometry2), {min:0,max:1,palette: ['red']}, 'deforestación 2015',false);
// Map.addLayer(dataset.select('lossyear').eq(16).selfMask().clip(geometry2), {min:0,max:1,palette: ['red']}, 'deforestación 2016',false);
// Map.addLayer(dataset.select('lossyear').eq(17).selfMask().clip(geometry2), {min:0,max:1,palette: ['red']}, 'deforestación 2017',false);
// Map.addLayer(dataset.select('lossyear').eq(18).selfMask().clip(geometry2), {min:0,max:1,palette: ['red']}, 'deforestación 2018',false);
// Map.addLayer(dataset.select('lossyear').eq(19).selfMask().clip(geometry2), {min:0,max:1,palette: ['red']}, 'deforestación 2019',false);
// Map.addLayer(dataset.select('lossyear').eq(20).selfMask().clip(geometry2), {min:0,max:1,palette: ['red']}, 'deforestación 2020',false);
// Map.addLayer(dataset.select('lossyear').eq(21).selfMask().clip(geometry2), {min:0,max:1,palette: ['red']}, 'deforestación 2021',false);
  
  });
  


var basemap1= nicfi.filter(ee.Filter.date('2021-01')).first();
var vis = {"bands":["R","G","B"],
    min:94,
    max:1150,
    gamma:0.74
};

Map.addLayer(basemap1, vis, '2021-01', false);

var ALOSDSMDEM = ee.Image  ('JAXA/ALOS/AW3D30_V1_1');
var ALOSDSM = ALOSDSMDEM.select('AVE').clip (geometry2);
Map.addLayer(ALOSDSM,
    {
    min: 10, 
    max: 400,
    palette: 
    [ '0602ff', '235cb1', '307ef3', '269db1', '30c8e2', '32d3ef', '3ae237',
      'b5e22e', 'd6e21f', 'fff705', 'ffd611', 'ffb613', 'ff8b13', 'ff6e08',
      'ff500d', 'ff0000', 'de0101', 'c21301'  ],
    }, 'DEM General',false);
    
    
    // Mosaicos anuales de ALOS PALSAR y ALOS PALSAR 2
// http://www.gisandbeers.com/descargar-alos-palsar-mosaicos-sar-anuales/

// Llamada a la colecciÃ³n de mosaicos anuales SAR de ALOS
var ALOS = ee.ImageCollection('JAXA/ALOS/PALSAR/YEARLY/SAR')
    .filterDate ('2020-01-01', '2021-01-01'); // Filtro anual

// SelecciÃ³n de banda HH y simbologÃ­a
var BandaHH = ALOS.select('HH');
var DatosHH = {
  min: 0.0,
  max: 10000.0,
  palette: ['042333', '2c3395', '744992', 'b15f82', 'eb7958', 'fbb43d', 'e8fa5b'],};

// SelecciÃ³n de banda HV y simbologÃ­a
var BandaHV = ALOS.select('HV');
var DatosHV = {
  min: 0.0,
  max: 5000.0,
  palette: ['040613', '292851', '3f4b96', '427bb7', '61a8c7', '9cd4da', 'eafdfd'],};

// RepresentaciÃ³n de bandas HH y HV en visor
Map.addLayer(BandaHH, DatosHH, 'Banda HH',false);
Map.addLayer(BandaHV, DatosHV, 'Banda HV',false);



/**
 * 
 * getReference
 * @roi
 * @region
 * @stables
 * @accumulated
 */
function getReference(roi, region, stables, accumulated) {
  
  stables     = stables.clip(region);
  accumulated = accumulated.clip(region);
  roi         = roi.clip(region);
  
  var reference = roi
    .where(stables.eq(1).and(accumulated.eq(1)), 6)
    .where(stables.eq(0).and(accumulated.eq(1)), 0);
  
  reference = reference.remap([0, 1, 6], [0, 27, 6], 0);
  
  return reference
    .updateMask(reference.neq(0))
    .rename('reference');
  
}







/**
 * 
 * getMosaic
 * @mosaics
 * @regionId
 * @year
 * @variables
 */
function getMosaic(mosaics, regionId, year, variables) {
  
  // Additional variables
  var slppost = ee.Image(slpposPath);
  var altitude = ee.Image(altitudePath).select('AVE').rename('altitude');
  var slope = ee.Terrain.slope(altitude).int8().rename('slope');
  
  var getMndwi = function(image) {
    var mndwi = image.expression(
      '(GREEN - SWIR1) / (GREEN + SWIR1)',  
      {
        GREEN: image.select('green_median'),
        SWIR1: image.select('swir1_median')
      }
    )
    .multiply(100).add(100).byte()
    .rename('mndwi_median');
  
    return image.addBands(mndwi);
  };

  var getMmri = function(image) { 
    var mmri = image.expression(
      '(MNDWI - NDVI) / (MNDWI + NDVI)',  
      {
        MNDWI: image.select('mndwi_median'),
        NDVI: image.select('ndvi_median')
      }
    )
    .multiply(100).add(100).byte()
    .rename('mmri_median');
    
    return image.addBands(mmri);
  };
  
  var getClay = function(image) {
    var clay = image.expression(
      '(SWIR1 / SWIR2)',  
      {
        SWIR1: image.select('swir1_median'),
        SWIR2: image.select('swir2_median') 
      }
    )
    .multiply(100).add(100).int16()
    .rename('clay_median');
    
    return image.addBands(clay);    
  };
  
  var getBai = function(image) {
    var bai = image.expression(
      '1 / ( ((0.1 - RED) ** 2) + ((0.06 - NIR) ** 2) )',  
      {
        NIR: image.select('nir_median'),
        RED: image.select('red_median') 
      }
    )
    .multiply(100).add(100).int16()
    .rename('bai_median');
    
    return image.addBands(bai);    
  };
  
  var tasseledCap = function(image){
    var sensor = ee.String(image.get('satellite')).slice(1);
    
    var landsatBands = {
      BLUE: image.select('blue_median'),
      GREEN: image.select('green_median'),
      RED: image.select('red_median'),
      NIR: image.select('nir_median'),
      SWIR1: image.select('swir1_median'),
      SWIR2: image.select('swir2_median'),
    };

    
    var brightness = ee.Image(
      ee.Algorithms.If(
        ee.Algorithms.IsEqual(sensor, '8'),
        // Landsat 8
        image.expression(
          '(BLUE * 0.3029) + (GREEN * 0.2786) + (RED * 0.4733) +\
           (NIR * 0.5599) + (SWIR1 * 0.508) + (SWIR2 * 0.1872)',
          landsatBands
        ),
        // Landsat 5, 7, X
        image.expression(
          '(BLUE * 0.3037) + (GREEN * 0.2793) + (RED * 0.4743) +\
           (NIR * 0.5585) + (SWIR1 * 0.5082) + (SWIR2 * 0.1863)',
          landsatBands
        )
      )
    ).rename('brightness').toInt16();
    
    var greeness = ee.Image(
      ee.Algorithms.If(
        ee.Algorithms.IsEqual(sensor, '8'),
        // Landsat 8
        image.expression(
          '-(BLUE * 0.2941) - (GREEN * 0.243) - (RED * 0.5424) +\
           (NIR * 0.7276) + (SWIR1 * 0.0713) - (SWIR2 * 0.1608)',
          landsatBands
        ),
        // Landsat 5, 7, X
        image.expression(
          '-(BLUE * 0.2848) - (GREEN * 0.2435) - (RED * 0.5436) +\
           (NIR * 0.7243) + (SWIR1 * 0.0840) - (SWIR2 * 0.1800)',
          landsatBands
        )
      )
    ).rename('greeness').toInt16();
    
    var wetness = ee.Image(
      ee.Algorithms.If(
        ee.Algorithms.IsEqual(sensor, '8'),
        // Landsat 8
        image.expression(
          '(BLUE * 0.1511) + (GREEN * 0.1973) + (RED * 0.3283) +\
           (NIR * 0.3407) - (SWIR1 * 0.7117) - (SWIR2 * 0.4559)',
          landsatBands
        ),
        // Landsat 5, 7, X
        image.expression(
          '-(BLUE * 0.1509) + (GREEN * 0.1973) + (RED * 0.3279) +\
           (NIR * 0.3406) - (SWIR1 * 0.7112) - (SWIR2 * 0.4572)',
          landsatBands
        )
      )
    ).rename('wetness').toInt16();
    
    
    return image
      .addBands(brightness)
      .addBands(greeness)
      .addBands(wetness);

  };
  
  
  // Aditional Bands
  var joinedMosaics = mosaics
      .filter(
        ee.Filter.and(
          ee.Filter.eq('year', year),
          ee.Filter.eq('region_code', regionId)
        )
      )
      .map(function(item) {
        return item.addBands([slppost, altitude, slope]);
      })
      .map(getMndwi)
      .map(getMmri)
      .map(getClay)
      .map(tasseledCap)
      .mosaic();

  
  // Select variables
  if(variables.length === 0) return joinedMosaics;
  else return joinedMosaics.select(variables);
  
}







/**
 * 
 * getRegion
 * @regions
 * @regionIds
 */
function getRegion(vector, raster, regionId) {
  
  var region = vector
    .filter( ee.Filter.eq('id_regionC', regionId) );
    
  var image = raster.clip(region).rename('regionid');
  
  return {
    vector: region,
    raster: image
  };
  
}






/**
 * 
 * spatialFilter function
 * @image
 * @minMappingUnit
 */
function spatialFilter(image, minMappingUnit) {

  var connectedPixels = image
    .connectedPixelCount(minMappingUnit, false);
  
  var correct = image
    .where(connectedPixels.gte(minMappingUnit).and(image.eq(0)), 1)
    .neq(1).selfMask();
  
  return image.updateMask(connectedPixels.gte(minMappingUnit));
  
}






/**
 * 
 * resampleCover 
 * @mosaic
 * @additionalSamples
 */
function resampleCover(mosaic, additionalSamples) {
  
  var polygons = additionalSamples.polygons,
      classIds = additionalSamples.classes,
      points = additionalSamples.points,
      newSamples = [];
  
  polygons.forEach(function(polygon, i) {
    
    var newSample = mosaic.sample({
      numPixels: points[ i ],
      region: polygon.geometry(),
      scale: 30,
      projection: 'EPSG:4326',
      seed: 1,
      geometries: true,
      tileScale: 8
    })
    .map(function(item) { return item.set('reference', classIds[ i ]) });
    
    newSamples.push(newSample);

  });
  
  return ee.FeatureCollection(newSamples).flatten();

}






/**
 * 
 * remapWithPolygons
 * @image
 * @polygons
 */
function remapWithPolygons(image, polygons) {
  
  if(polygons.length > 0) {
    polygons.forEach(function( polygon ) {
      
      var excluded = polygon.map(function(layer){
        var area = image.clip( layer );

        var from = ee.String(layer.get('from'))
          .split(',')
          .map(function(item) { return ee.Number.parse(item) });
          
        var to = ee.String(layer.get('to'))
          .split(',')
          .map(function(item){ return ee.Number.parse(item) });
        
        return area.remap(from, to);
      });
        
      excluded = ee.ImageCollection(excluded).mosaic();
      image = excluded.unmask(image).rename('reference');
      image = image.mask(image.neq(0));
    });
  }
  else image = image;

  return image;
  
}